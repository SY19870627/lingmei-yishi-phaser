{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "StoryList",
  "type": "array",
  "items": {
    "type": "object",
    "additionalProperties": false,
    "required": ["id", "anchor", "steps"],
    "properties": {
      "id": { "type": "string" },
      "anchor": { "type": "string" },
      "steps": {
        "type": "array",
        "items": {
          "oneOf": [
            {
              "type": "object",
              "additionalProperties": false,
              "required": ["t", "who", "text", "lineId"],
              "properties": {
                "t": { "const": "TEXT" },
                "who": { "type": "string" },
                "text": { "type": "string" },
                "lineId": { "type": "string" },
                "updates": {
                  "type": "array",
                  "items": { "type": "string" }
                }
              }
            },
            {
              "type": "object",
              "additionalProperties": false,
              "required": ["t", "spiritId"],
              "properties": {
                "t": { "const": "CALL_GHOST_COMM" },
                "spiritId": { "type": "string" },
                "lineId": { "type": "string" }
              }
            },
            {
              "type": "object",
              "additionalProperties": false,
              "required": ["t", "npcId"],
              "properties": {
                "t": { "const": "CALL_MEDIATION" },
                "npcId": { "type": "string" },
                "lineId": { "type": "string" }
              }
            },
            {
              "type": "object",
              "additionalProperties": false,
              "required": ["t", "itemId"],
              "properties": {
                "t": { "const": "GIVE_ITEM" },
                "itemId": { "type": "string" },
                "message": { "type": "string" },
                "lineId": { "type": "string" }
              }
            },
            {
              "type": "object",
              "additionalProperties": false,
              "required": ["t", "flag", "value"],
              "properties": {
                "t": { "const": "UPDATE_FLAG" },
                "flag": { "type": "string" },
                "value": {},
                "lineId": { "type": "string" }
              }
            },
            {
              "type": "object",
              "additionalProperties": false,
              "required": ["t"],
              "properties": {
                "t": { "const": "END" },
                "lineId": { "type": "string" }
              }
            },
            {
              "type": "object",
              "additionalProperties": false,
              "required": ["t", "options", "lineId"],
              "properties": {
                "t": { "const": "CHOICE" },
                "lineId": { "type": "string" },
                "options": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "oneOf": [
                      {
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["action", "text", "targetLineId"],
                        "properties": {
                          "action": { "const": "GOTO_LINE" },
                          "text": { "type": "string" },
                          "targetLineId": { "type": "string" },
                          "nextLineId": { "type": "string" }
                        }
                      },
                      {
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["action", "text", "storyId"],
                        "properties": {
                          "action": { "const": "START_STORY" },
                          "text": { "type": "string" },
                          "storyId": { "type": "string" },
                          "nextLineId": { "type": "string" }
                        }
                      },
                      {
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["action", "text", "spiritId"],
                        "properties": {
                          "action": { "const": "CALL_GHOST_COMM" },
                          "text": { "type": "string" },
                          "spiritId": { "type": "string" },
                          "nextLineId": { "type": "string" }
                        }
                      },
                      {
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["action", "text", "npcId"],
                        "properties": {
                          "action": { "const": "CALL_MEDIATION" },
                          "text": { "type": "string" },
                          "npcId": { "type": "string" },
                          "nextLineId": { "type": "string" }
                        }
                      },
                      {
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["action", "text"],
                        "properties": {
                          "action": { "const": "END" },
                          "text": { "type": "string" },
                          "nextLineId": { "type": "string" }
                        }
                      }
                    ]
                  }
                }
              }
            }
          ]
        }
      },
      "service": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "spiritId",
          "triggerLine"
        ],
        "properties": {
          "spiritId": {
            "type": "string"
          },
          "triggerLine": {
            "type": "integer",
            "minimum": 1
          }
        }
      }
    }
  }
}
